/* Bootstrap 5.3.3 - Essential JavaScript for Offline Use */
(function() {
  'use strict';
  
  // Collapse functionality
  function initCollapse() {
    document.addEventListener('click', function(e) {
      var target = e.target.closest('[data-bs-toggle="collapse"]');
      if (!target) return;
      
      e.preventDefault();
      var selector = target.getAttribute('data-bs-target');
      var element = document.querySelector(selector);
      
      if (!element) return;
      
      if (element.classList.contains('show')) {
        element.classList.remove('show');
        target.setAttribute('aria-expanded', 'false');
      } else {
        element.classList.add('show');
        target.setAttribute('aria-expanded', 'true');
      }
    });
  }
  
  // Navbar toggle functionality
  function initNavbar() {
    document.addEventListener('click', function(e) {
      var target = e.target.closest('.navbar-toggler');
      if (!target) return;
      
      e.preventDefault();
      var selector = target.getAttribute('data-bs-target');
      var element = document.querySelector(selector);
      
      if (!element) return;
      
      element.classList.toggle('show');
    });
  }
  
  // Modal functionality (basic)
  function initModal() {
    document.addEventListener('click', function(e) {
      var target = e.target.closest('[data-bs-toggle="modal"]');
      if (!target) return;
      
      e.preventDefault();
      var selector = target.getAttribute('data-bs-target');
      var modal = document.querySelector(selector);
      
      if (modal) {
        modal.style.display = 'block';
        modal.classList.add('show');
      }
    });
    
    // Close modal
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('modal') || e.target.closest('[data-bs-dismiss="modal"]')) {
        var modal = e.target.closest('.modal') || e.target;
        if (modal.classList.contains('modal')) {
          modal.style.display = 'none';
          modal.classList.remove('show');
        }
      }
    });
  }
  
  // Tooltip functionality (basic)
  function initTooltips() {
    var tooltips = document.querySelectorAll('[data-bs-toggle="tooltip"]');
    tooltips.forEach(function(element) {
      element.addEventListener('mouseenter', function() {
        var title = this.getAttribute('title') || this.getAttribute('data-bs-title');
        if (title) {
          var tooltip = document.createElement('div');
          tooltip.className = 'tooltip fade show bs-tooltip-top';
          tooltip.innerHTML = '<div class="tooltip-arrow"></div><div class="tooltip-inner">' + title + '</div>';
          document.body.appendChild(tooltip);
          
          var rect = this.getBoundingClientRect();
          tooltip.style.position = 'absolute';
          tooltip.style.top = (rect.top - tooltip.offsetHeight - 5) + 'px';
          tooltip.style.left = (rect.left + rect.width / 2 - tooltip.offsetWidth / 2) + 'px';
          tooltip.style.zIndex = '1070';
          
          this._tooltip = tooltip;
        }
      });
      
      element.addEventListener('mouseleave', function() {
        if (this._tooltip) {
          document.body.removeChild(this._tooltip);
          this._tooltip = null;
        }
      });
    });
  }
  
  // Initialize all components when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      initCollapse();
      initNavbar();
      initModal();
      initTooltips();
    });
  } else {
    initCollapse();
    initNavbar();
    initModal();
    initTooltips();
  }
  
  // Export Bootstrap object for compatibility
  window.bootstrap = {
    Collapse: function(element) {
      return {
        toggle: function() {
          element.classList.toggle('show');
        },
        show: function() {
          element.classList.add('show');
        },
        hide: function() {
          element.classList.remove('show');
        }
      };
    },
    Toast: function(element) {
      return {
        show: function() {
          if (element) {
            element.style.display = 'block';
            element.classList.add('show');
            
            // Auto-hide after 5 seconds
            setTimeout(function() {
              element.classList.remove('show');
              setTimeout(function() {
                if (element.parentNode) {
                  element.parentNode.removeChild(element);
                }
              }, 300);
            }, 5000);
          }
        },
        hide: function() {
          if (element) {
            element.classList.remove('show');
            setTimeout(function() {
              if (element.parentNode) {
                element.parentNode.removeChild(element);
              }
            }, 300);
          }
        }
      };
    }
  };
  
})();